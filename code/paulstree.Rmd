---
title: "test"
author: "Jared Flater"
date: "5/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(reshape2)
library(tidyverse)
library(phyloseq)
```
```{r}
tree <- read.tree("data/tree.nwk")
inc.physeq <- readRDS("data/RDS/incubation_physeq_Aug18.RDS")
inc <- merge_phyloseq(inc.physeq, tree)
inc <- subset_samples(inc, day %in% c("7", "14", "21", "35", "49", "97"))

# too big, need smaller tree, use a phyloseq object with tree added and then only use one phyla
TopNOTUs = names(sort(taxa_sums(inc), TRUE)[1:100])
inc10 = prune_taxa(TopNOTUs, inc) %>%
  filter_taxa(function(x) sum(x) >= 3, T)

t1 <- phy_tree(inc10)
data <- psmelt(inc10) 
```

```{r}
cast.data <- data %>% 
  group_by(OTU, treatment) %>% 
  summarise_at('Abundance', mean) %>% 
  dcast(OTU ~ treatment) %>%
  column_to_rownames("OTU")

cast.data  
```
```{r}
pp <- ggtree(t1, layout='circular', color="black", size=1, branch.length='none', right=T) 
pp
```
```{r}
ph <- gheatmap(pp, cast.data, colnames = T, width=0.2, hjust='left', colnames_angle=-10, font.size=4)  +
   theme_tree() 
ph
```

